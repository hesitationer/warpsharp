INC_DIRS = 
LIB_DIRS = 

LIBS = user32.lib vfw32.lib comsupp.lib
DEFS = /DWIN32_LEAN_AND_MEAN /DNOMINMAX

OPTS = /FAsc /EHsc /GR /MD /nologo /W0 /Ox /GA /arch:SSE2
#OPTS = /FAsc /GX /GR /MD /G7 /nologo /W0 /Ox /GA /arch:SSE2
#OPTS = /FAsc /GX /GR /MD /G7 /nologo /W0 /Ox /Ob2 /GA /arch:SSE2
#OPTS = /FAsc /EHsc /GR /MD /GA /nologo /W0 /Oityb2 /Gs

CFLAGS = $(INC_DIRS) $(OPTS) $(DEFS)
CPPFLAGS = $(CFLAGS)
UPXFLAGS = -9

AUOENC_TARGET  = auoenc.exe
AUOENC_SOURCES = auoenc.cpp
AUOENC_OBJECTS = $(AUOENC_SOURCES:.cpp=.obj)

LOADPLUGINEX_TARGET  = LoadPluginEx.dll
LOADPLUGINEX_SOURCES = LoadPluginEx1.cpp LoadPluginEx2.cpp
LOADPLUGINEX_OBJECTS = $(LOADPLUGINEX_SOURCES:.cpp=.obj)

WARPSHARP_TARGET  = warpsharp.dll
WARPSHARP_SOURCES = warpsharp.cpp focus.cpp deint.cpp ghost.cpp aviutl.cpp misc.cpp
WARPSHARP_OBJECTS = $(WARPSHARP_SOURCES:.cpp=.obj)

SHOWAUFINFO_TARGET  = ShowAUFInfo.exe
SHOWAUFINFO_SOURCES = ShowAUFInfo.cpp
SHOWAUFINFO_OBJECTS = $(SHOWAUFINFO_SOURCES:.cpp=.obj)

AVSINPUT_TARGET  = avsinp.aui
AVSINPUT_SOURCES = avsinp.cpp
AVSINPUT_OBJECTS = $(AVSINPUT_SOURCES:.cpp=.obj)

AVSFILTER_TARGET  = avsfilter.dll
AVSFILTER_SOURCES = avsfilter.cpp
AVSFILTER_OBJECTS = $(AVSFILTER_SOURCES:.cpp=.obj)

AVSFILTER_AUF_TARGET  = avsfilter.auf
AVSFILTER_AUF_SOURCES = avsfilter_auf.cpp
AVSFILTER_AUF_OBJECTS = $(AVSFILTER_AUF_SOURCES:.cpp=.obj)

AVSFILTER_VDF_TARGET  = avsfilter.vdf
AVSFILTER_VDF_SOURCES = avsfilter_vdf.cpp
AVSFILTER_VDF_OBJECTS = $(AVSFILTER_VDF_SOURCES:.cpp=.obj)

TARGETS = $(WARPSHARP_TARGET)  $(LOADPLUGINEX_TARGET)
SOURCES = $(WARPSHARP_SOURCES) $(LOADPLUGINEX_SOURCES)
OBJECTS = $(WARPSHARP_OBJECTS) $(LOADPLUGINEX_OBJECTS)

TARGETS = $(TARGETS) $(AUOENC_TARGET)  $(SHOWAUFINFO_TARGET)  $(AVSINPUT_TARGET)
SOURCES = $(SOURCES) $(AUOENC_SOURCES) $(SHOWAUFINFO_SOURCES) $(AVSINPUT_SOURCES)
OBJECTS = $(OBJECTS) $(AUOENC_OBJECTS) $(SHOWAUFINFO_OBJECTS) $(AVSINPUT_OBJECTS)

TARGETS = $(TARGETS) $(AVSFILTER_TARGET)  $(AVSFILTER_AUF_TARGET)  $(AVSFILTER_VDF_TARGET)
SOURCES = $(SOURCES) $(AVSFILTER_SOURCES) $(AVSFILTER_AUF_SOURCES) $(AVSFILTER_VDF_SOURCES)
OBJECTS = $(OBJECTS) $(AVSFILTER_OBJECTS) $(AVSFILTER_AUF_OBJECTS) $(AVSFILTER_VDF_OBJECTS)

DEPEND = depend.mak

default: $(TARGETS)

$(LOADPLUGINEX_TARGET): $(LOADPLUGINEX_OBJECTS)
	$(CC) /LD$(DEBUG) $(LOADPLUGINEX_OBJECTS) /link /OUT:$(LOADPLUGINEX_TARGET) $(LIB_DIRS) $(LIBS)
#	upx $(UPXFLAGS) $(LOADPLUGINEX_TARGET)

$(WARPSHARP_TARGET): $(WARPSHARP_OBJECTS)
	$(CC) /LD$(DEBUG) $(WARPSHARP_OBJECTS) /link /OUT:$(WARPSHARP_TARGET) $(LIB_DIRS) $(LIBS)
#	upx $(UPXFLAGS) $(WARPSHARP_TARGET)

$(SHOWAUFINFO_TARGET): $(SHOWAUFINFO_OBJECTS)
	$(CC) $(SHOWAUFINFO_OBJECTS) /link /OUT:$(SHOWAUFINFO_TARGET) $(LIB_DIRS) $(LIBS) setargv.obj
#	upx $(UPXFLAGS) $(SHOWAUFINFO_TARGET)

$(AVSINPUT_TARGET): $(AVSINPUT_OBJECTS)
	$(CC) /LD$(DEBUG) $(AVSINPUT_OBJECTS) /link /OUT:$(AVSINPUT_TARGET) $(LIB_DIRS) $(LIBS) /EXPORT:GetInputPluginTable
#	upx $(UPXFLAGS) $(AVSINPUT_TARGET)

$(AVSFILTER_TARGET): $(AVSFILTER_OBJECTS)
	$(CC) /LD$(DEBUG) $(AVSFILTER_OBJECTS) /link /OUT:$(AVSFILTER_TARGET) $(LIB_DIRS) $(LIBS)
#	upx $(UPXFLAGS) $(AVSFILTER_TARGET)

$(AVSFILTER_AUF_TARGET): $(AVSFILTER_AUF_OBJECTS) $(AVSFILTER_TARGET)
	$(CC) /LD$(DEBUG) $(AVSFILTER_AUF_OBJECTS) /link /OUT:$(AVSFILTER_AUF_TARGET) $(LIB_DIRS) $(LIBS) avsfilter.lib /EXPORT:GetFilterTable

$(AVSFILTER_VDF_TARGET): $(AVSFILTER_VDF_OBJECTS) $(AVSFILTER_TARGET)
	$(CC) /LD$(DEBUG) $(AVSFILTER_VDF_OBJECTS) /link /OUT:$(AVSFILTER_VDF_TARGET) $(LIB_DIRS) $(LIBS) avsfilter.lib

$(OBJECTS): makefile $(DEPEND)

debug:
	$(MAKE) DEBUG=d

dep:
	python mkdep.py $(INC_DIRS) $(SOURCES)>$(DEPEND)

clean:
	del *.obj *.cod *.lib *.exp *.cxx *.pyc *.exe *.dll *.auf *.aui *.vdf

!include $(DEPEND)
